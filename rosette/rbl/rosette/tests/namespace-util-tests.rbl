;;; Copyright (c) 2018, RChain Cooperative
;;; Author: Kent Shikama <kent@kentshikama.com>
;;; This file is licensed under the Apache License, version 2.0.

;;; tests for tbl-unique-append
(let* [[chart (new RblTable)]]
  (seq
    (let [[_ (tbl-unique-append chart 'hello 'world)]]
      (test-form (tbl-get chart 'hello) ['world]))
    ;; adding another 'world should have no effect
    (let [[_ (tbl-unique-append chart 'hello 'world)]]
      (test-form (tbl-get chart 'hello) ['world]))
    ;; adding a different value changes the chart
    (let [[_ (tbl-unique-append chart 'hello 'world2)]]
      (test-form (tbl-get chart 'hello) ['world 'world2]))))

(let* [[chart (new RblTable)]
       [_ (tbl-add chart 'hello [])]]
  (seq
    ;; adding to an empty tuple works
    (let [[_ (tbl-unique-append chart 'hello 'world)]]
      (test-form (tbl-get chart 'hello) ['world]))
    ;; adding a different value on top still works
    (let [[_ (tbl-unique-append chart 'hello 'world2)]]
      (test-form (tbl-get chart 'hello) ['world 'world2]))))

;;; TODO: Discuss whether empty tuples should match
(test-form (match-tuple-pattern [] []) #t)
(test-form (match-tuple-pattern [1] []) #f)
(test-form (match-tuple-pattern [1 2 3] [1 2 3]) #t)
(test-form (match-tuple-pattern ['anything 2 3] [1 2 3]) #t)
(test-form (match-tuple-pattern [42 2 3] [1 2 3]) #f)
(test-form (match-tuple-pattern [0] [1]) #f)
(test-form (match-tuple-pattern ["a"] ['foo]) #f)
(test-form (match-tuple-pattern [0] ['foo]) #f)
(test-form (match-tuple-pattern ['foo] [2]) #t)

(test-form (concat-symbol-list []) ')
(test-form (concat-symbol-list ['hello 'world]) 'helloworld)
(test-form (concat-symbol-list ['hello 'world 'again]) 'helloworldagain)

(test-form (append-tuples []) [])
(test-form (append-tuples [[1 2] [3 4] [5 6]]) [1 2 3 4 5 6])
(test-form (append-tuples [['a 'b] ['c 'd] ['e ['f 'g]]]) ['a 'b 'c 'd 'e ['f 'g]])

;;; should return empty list if no values
(test-form (non-niv-head []) [])
(test-form (non-niv-head [#niv #niv #niv]) [])
(test-form (non-niv-head [#niv #niv 2 3]) 2)

(test-form (any-null? [1 2 3 4]) #f)
(test-form (any-null? [1 [] 3 4]) #t)
(test-form (any-null? [1 [2] [3 4] 4]) #f)

(if (> failures 0)
    (display "Successes: " successes ". Failures: " failures ".\n")
    (display "All tests passed.\n"))
